<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DynaDuck - Home</title>
<link rel="stylesheet" href="style.css">
<style>
/* Overlay Game View */
#gameView {
  display: none;
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background: rgba(0,0,0,0.7);
  z-index:1000;
  justify-content: center;
  align-items: center;
}

#gameView > div {
  display: flex;
  background:white;
  border-radius:12px;
  overflow:hidden;
  max-width:900px;
  width:90%;
  box-shadow:0 5px 25px rgba(0,0,0,0.5);
}

#gameView img {
  width:50%;
  object-fit:cover;
}

#gameView .game-info-panel {
  padding:20px;
  flex:1;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.back-btn {
  background: #ccc;
  padding: 8px 15px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}
.back-btn:hover { background: #aaa; }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <img src="logo.png" class="logo" alt="DynaDuck Logo" />
    <nav>
      <a href="catalog.html">Catalog</a>
      <a href="ideas.html">Ideas</a>
      <a href="create.html">Create</a>
      <a href="dynamites.html">Dynamites</a>
    </nav>
  </div>

  <div class="search-container">
    <input type="text" class="search-bar" placeholder="Search...">
  </div>

  <div id="authButtons">
    <a href="signup.html"><button class="green-btn">Sign Up</button></a>
    <a href="login.html"><button class="green-btn">Log In</button></a>
  </div>
</header>

<div class="login-prompt">
  Please <a href="signup.html">Sign Up</a> / <a href="login.html">Log In</a> to play games! :D
</div>

<main>
  <!-- FRIENDS SECTION -->
  <h2>Your Friends</h2>
  <div id="friendsList" style="padding: 0 40px; display:flex; gap:10px; flex-wrap: wrap;"></div>

  <h2>Friend Requests</h2>
  <div id="friendRequests" style="padding: 0 40px; display:flex; gap:10px; flex-wrap: wrap;"></div>

  <div style="padding: 0 40px; margin-top: 10px; margin-bottom: 30px;">
    <input type="text" id="friendInput" placeholder="Add friend by username" style="padding:8px; border-radius:8px; border:1px solid #ccc;">
    <button class="green-btn" onclick="sendFriendRequest()">Send Request</button>
  </div>

  <!-- GAMES GRID -->
  <h1>Games</h1>
  <div class="games-grid">
    <div class="game-card" onclick="openGameView('Baseplate')">
      <img src="photo.png" alt="Baseplate Thumbnail" class="game-thumb">
      <div class="game-info">
        <h2>Baseplate</h2>
        <p>First game on this platform yay :D</p>
        <p class="creator">Creator: Admin</p>
      </div>
    </div>

    <div class="game-card" onclick="openGameView('CrossRoads')">
      <img src="photo.png" alt="CrossRoads Thumbnail" class="game-thumb">
      <div class="game-info">
        <h2>CrossRoads</h2>
        <p>Yay fighting game :D</p>
        <p class="creator">Creator: Admin</p>
      </div>
    </div>
  </div>
</main>

<!-- GAME VIEW OVERLAY -->
<div id="gameView">
  <div>
    <img id="gameViewThumb" src="" alt="Game Thumbnail">
    <div class="game-info-panel">
      <h1 id="gameViewName"></h1>
      <p id="gameViewCreator" style="color:#11AD36;font-weight:600;"></p>
      <p id="gameViewDesc"></p>
      <button class="green-btn big-play" id="playBtn" style="font-size:1.2em; padding:12px;">▶ Play</button>
      <div class="private-server" style="margin-top:10px;">
        <h3>Private Server</h3>
        <p>Create a private server to play with friends!</p>
        <button class="green-btn">Create Server</button>
      </div>
      <button class="back-btn" onclick="closeGameView()">← Back</button>
    </div>
  </div>
</div>

<script>
/* ------------------- Header & Login ------------------- */
function updateHeader() {
  const authDiv = document.getElementById('authButtons');
  const loggedInUser = localStorage.getItem('loggedInUser');

  if(loggedInUser){
    authDiv.innerHTML = `
      <span style="color:white;font-weight:bold;margin-right:15px;">Welcome, ${loggedInUser}!</span>
      <a href="settings.html"><button class="green-btn">Settings</button></a>
      <button class="green-btn" onclick="logout()">Logout</button>
    `;
    document.querySelector('.login-prompt').style.display = 'none';
    loadFriends();
    loadFriendRequests();
  } else {
    authDiv.innerHTML = `
      <a href="signup.html"><button class="green-btn">Sign Up</button></a>
      <a href="login.html"><button class="green-btn">Log In</button></a>
    `;
    document.querySelector('.login-prompt').style.display = 'block';
  }
}

function logout(){
  localStorage.removeItem('loggedInUser');
  updateHeader();
}

/* ------------------- Friends ------------------- */
function loadFriends(){
  const friendsList = document.getElementById('friendsList');
  friendsList.innerHTML = '';
  const loggedInUser = localStorage.getItem('loggedInUser');
  if(!loggedInUser) return;
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  const friends = users[loggedInUser]?.friends || [];
  friends.forEach(friend => {
    const div = document.createElement('div');
    div.style.border = '1px solid #ccc';
    div.style.padding = '8px';
    div.style.borderRadius = '8px';
    div.style.background = '#fff';
    div.style.minWidth = '120px';
    div.style.textAlign = 'center';
    div.innerHTML = `<strong>${friend}</strong><br>
      <button class="green-btn" style="font-size:0.8em;padding:4px 8px;margin-top:5px;" onclick="removeFriend('${friend}')">Remove</button>`;
    friendsList.appendChild(div);
  });
}
function removeFriend(friendName){
  const loggedInUser = localStorage.getItem('loggedInUser');
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  users[loggedInUser].friends = users[loggedInUser].friends.filter(f => f !== friendName);
  localStorage.setItem('users', JSON.stringify(users));
  loadFriends();
}

/* ------------------- Friend Requests ------------------- */
function sendFriendRequest(){
  const input = document.getElementById('friendInput');
  const friendName = input.value.trim();
  if(!friendName) return alert('Enter a username.');
  const loggedInUser = localStorage.getItem('loggedInUser');
  if(!loggedInUser) return alert('Please log in.');
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  if(!users[friendName]) return alert('User not found.');
  if(friendName === loggedInUser) return alert("You can't friend yourself.");
  users[friendName].requests = users[friendName].requests || [];
  if(users[friendName].requests.includes(loggedInUser)) return alert('Request already sent.');
  users[friendName].requests.push(loggedInUser);
  localStorage.setItem('users', JSON.stringify(users));
  input.value = '';
  alert('Friend request sent!');
}
function loadFriendRequests(){
  const requestsDiv = document.getElementById('friendRequests');
  requestsDiv.innerHTML = '';
  const loggedInUser = localStorage.getItem('loggedInUser');
  if(!loggedInUser) return;
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  const requests = users[loggedInUser]?.requests || [];
  requests.forEach(req => {
    const div = document.createElement('div');
    div.style.border = '1px solid #ccc';
    div.style.padding = '8px';
    div.style.borderRadius = '8px';
    div.style.background = '#fff';
    div.style.minWidth = '150px';
    div.style.textAlign = 'center';
    div.innerHTML = `
      <strong>${req}</strong><br>
      <button class="green-btn" style="font-size:0.8em;padding:4px 8px;margin-top:5px;" onclick="acceptRequest('${req}')">Accept</button>
      <button class="green-btn" style="background:#ccc;font-size:0.8em;padding:4px 8px;margin-top:5px;" onclick="declineRequest('${req}')">Decline</button>`;
    requestsDiv.appendChild(div);
  });
}
function acceptRequest(friendName){
  const loggedInUser = localStorage.getItem('loggedInUser');
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  users[loggedInUser].friends = users[loggedInUser].friends || [];
  if(!users[loggedInUser].friends.includes(friendName)) users[loggedInUser].friends.push(friendName);
  users[friendName].friends = users[friendName].friends || [];
  if(!users[friendName].friends.includes(loggedInUser)) users[friendName].friends.push(loggedInUser);
  users[loggedInUser].requests = users[loggedInUser].requests.filter(r=>r!==friendName);
  localStorage.setItem('users', JSON.stringify(users));
  loadFriends();
  loadFriendRequests();
}
function declineRequest(friendName){
  const loggedInUser = localStorage.getItem('loggedInUser');
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  users[loggedInUser].requests = users[loggedInUser].requests.filter(r=>r!==friendName);
  localStorage.setItem('users', JSON.stringify(users));
  loadFriendRequests();
}

/* ------------------- Game View Overlay ------------------- */
const gamesData = {
  "Baseplate": { thumb: "photo.png", name:"Baseplate", creator:"Admin", desc:"First game on this platform yay :D" },
  "CrossRoads": { thumb: "photo.png", name:"CrossRoads", creator:"Admin", desc:"Yay fighting game :D" }
};
function openGameView(gameName){
  const game = gamesData[gameName];
  document.getElementById('gameViewThumb').src = game.thumb;
  document.getElementById('gameViewName').innerText = game.name;
  document.getElementById('gameViewCreator').innerText = "Creator: " + game.creator;
  document.getElementById('gameViewDesc').innerText = game.desc;
  document.getElementById('playBtn').onclick = () => alert(`Now playing ${game.name}!`);
  document.getElementById('gameView').style.display = 'flex';
}
function closeGameView(){
  document.getElementById('gameView').style.display = 'none';
}

/* ------------------- Init ------------------- */
window.addEventListener('DOMContentLoaded', updateHeader);
</script>
</body>
</html>
